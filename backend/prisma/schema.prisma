generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. KULLANICI (DetaylÄ± Profil)
model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  firstName String   // Ad
  lastName  String   // Soyad
  phone    String? // Ä°letiÅŸim

  role String @default("CUSTOMER") // VarsayÄ±lan herkes MÃ¼ÅŸteridir.

  // ðŸ‘‡ YENÄ° EKLENENLER
  gender        String? // "Erkek", "KadÄ±n", "Belirtmek Ä°stemiyorum"
  userBirthDate DateTime? // KullanÄ±cÄ±nÄ±n doÄŸum gÃ¼nÃ¼ (SÃ¼rpriz iÃ§in)
  tcKimlikNo    String? // Fatura iÃ§in opsiyonel

  pets      Pet[]
  addresses Address[]
  orders    Order[]

  subscriptions Subscription[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 2. ADMÄ°N
model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("admin")
  createdAt DateTime @default(now())
}

// 3. ÃœRÃœN
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  
  // ðŸ‘‡ EKLENEN 1: URL'lerde kullanmak ve benzersizlik iÃ§in (Ã¶rn: /product/premium-box)
  slug        String   @unique 
  
  description String?
  price       Float
  image       String?
  stock       Int      @default(0)
  order       Int      @default(0)
  
  // ðŸ‘‡ EKLENEN 2: Paket iÃ§eriÄŸini maddeler halinde yazmak iÃ§in (PostgreSQL'de String[])
  features    String[] 

  isVisible   Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  orderItems    OrderItem[]
  subscriptions Subscription[]

  @@index([price])
  @@index([stock])
}

// 4. CAN DOSTUM (DetaylÄ±)
model Pet {
  id     Int  @id @default(autoincrement())
  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  name      String
  type      String // "kedi", "kopek"
  birthDate DateTime? // Net doÄŸum tarihi
  weight    String? // "4.5"

  // ðŸ‘‡ YENÄ° EKLENENLER
  breed      String? // Irk (Golden, Tekir vb.)
  isNeutered Boolean  @default(false) // KÄ±sÄ±r mÄ±?
  allergies  String[] // ["Tavuk", "TahÄ±l"] (Liste olarak tutacaÄŸÄ±z)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 5. ADRES (Atomik ParÃ§alar)
model Address {
  id     Int  @id @default(autoincrement())
  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  title String // "Evim", "Ä°ÅŸ"
  city  String // Ä°l

  // ðŸ‘‡ YENÄ° EKLENENLER (ParÃ§alanmÄ±ÅŸ Adres)
  district     String? // Ä°lÃ§e
  neighborhood String? // Mahalle
  street       String? // Sokak/Cadde
  buildingNo   String? // Bina No
  floor        String? // Kat
  apartmentNo  String? // Daire No

  // Yedek olarak tam metni de tutabiliriz ama parÃ§alÄ± yapÄ± esas olacak
  fullAddress String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 6. SÄ°PARÄ°Åž
model Order {
  id     Int   @id @default(autoincrement())
  userId Int?
  user   User? @relation(fields: [userId], references: [id])

  // Misafir Ä°letiÅŸim
  guestName  String?
  guestEmail String?
  guestPhone String?

  // Pet Temel Bilgisi
  petName String?

  // ðŸ‘‡ YENÄ° EKLENENLER (Misafir Pet DetaylarÄ± - Snapshot)
  petType      String? // "kopek"
  petBreed     String? // "Golden"
  petWeight    String? // "25"
  petBirthDate String? // "2022-01-01" (String tutabiliriz, analiz iÃ§in yeterli)
  petNeutered  String? // "true"/"false"

  // ... diÄŸer alanlar (city, address, totalPrice, status vb.)
  city       String?
  address    String
  totalPrice Float
  status     String  @default("SipariÅŸ AlÄ±ndÄ±")

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  items     OrderItem[]

  @@index([userId])
  @@index([status])
}

// 7. SÄ°PARÄ°Åž KALEMLERÄ°
model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  order     Order   @relation(fields: [orderId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int     @default(1)
  price     Float
}

// Mevcut modellerin altÄ±na ekle:

model Subscription {
  id              Int      @id @default(autoincrement())
  status          String   @default("ACTIVE") // ACTIVE, CANCELLED, PAUSED
  startDate       DateTime @default(now())
  nextPaymentDate DateTime // Bir sonraki yenilenme tarihi

  // Ä°liÅŸkiler
  userId Int
  user   User @relation(fields: [userId], references: [id])

  productId Int // Hangi pakete abone?
  product   Product @relation(fields: [productId], references: [id])

  petName String? // Hangi pet iÃ§in?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
